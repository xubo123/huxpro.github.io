<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hxy.core.news.dao.WebNewsTypeMapper">

	<!-- 查询新闻类别并分页 -->
	<select id="query" parameterType="map" resultType="com.hxy.core.news.entity.NewsType">
		select * from web_news_type
		<where>
			<if test="parent_id!=null and parent_id>=0">
				and parent_id = #{parent_id}
			</if>
			<if test="type!=null and type!=''">
				and type = #{type}
			</if>
			<if test="origin!=null and origin!=''">
				and origin = #{origin}
			</if>
			<if test="name!=null and name!=''">
				and name like concat('%',#{name},'%')
			</if>
			<if test="cityName!=null and cityName!=''">
				and cityName like concat('%',#{cityName},'%')
			</if>			
		</where>
		<if test="start!=null and rows!=null">
		order by origin,cityName,orderNum limit #{start},#{rows}
		</if>
	</select>
	
	<select id="getByName" parameterType="string" resultType="com.hxy.core.news.entity.NewsType">
		select * from web_news_type where name=#{name}
	</select>
	
	<!-- 查询数量条数 -->
	<select id="count" parameterType="map" resultType="java.lang.Integer">
		select count(*) from web_news_type
		<where>
			<if test="parent_id!=null and parent_id>=0">
				and parent_id = #{parent_id}
			</if>
			<if test="type!=null and type!=''">
				and type = #{type}
			</if>
			<if test="origin!=null and origin!=''">
				and origin = #{origin}
			</if>
			<if test="name!=null and name!=''">
				and name like concat('%',#{name},'%')
			</if>
			<if test="cityName!=null and cityName!=''">
				and cityName like concat('%',#{cityName},'%')
			</if>
		</where>
	</select>
	
	<!-- 查询新闻类别的详细信息 -->
	<select id="getById" parameterType="string" resultType="com.hxy.core.news.entity.NewsType">
		select t.*,p.`name`as parent_name,n.title as newsTitle,n.content as newsContent  
		from web_news_type  t
		LEFT JOIN web_news_type p ON t.parent_id = p.id
		LEFT JOIN news n on t.id= n.categoryWeb and t.type=3
		where t.id = #{id};
	</select>
	
	<!-- 新闻栏目新增 -->
	<insert id="save" parameterType="com.hxy.core.news.entity.NewsType">
		insert into web_news_type(id,parent_id,name,type,url,orderNum,origin,cityName,isMain,isNavigation)
		values(#{id},#{parent_id},#{name},#{type},#{url},#{orderNum},#{origin},#{cityName},#{isMain},#{isNavigation})
	</insert>
	
	<select id="getNewId" resultType="long">
        select LAST_INSERT_ID()
    </select>
    
	<!-- 新闻栏目删除,根据id -->
	<delete id="deleteById" parameterType="list">
		delete from web_news_type where id in
		<foreach collection="list" open="(" close=")" item="ids" separator=",">
			#{ids}
		</foreach>
	</delete>
	
	<!-- 新闻栏目删除,根据父id -->
	<delete id="deleteByPid" parameterType="list">
		delete from web_news_type where parent_id in
		<foreach collection="list" open="(" close=")" item="ids" separator=",">
			#{ids}
		</foreach>
	</delete>
	
	<!-- 新闻栏目更新 -->
	<update id="update" parameterType="com.hxy.core.news.entity.NewsType" >
		update web_news_type set
	 		name=#{name},
	 		parent_id=#{parent_id},
	 		type=#{type},
	 		url=#{url},
	 		origin=#{origin},
	 		orderNum=#{orderNum},
		 	cityName = #{cityName},
		 	isMain = #{isMain},
		 	isNavigation = #{isNavigation}
		 where id = #{id}
	</update>
	
	<insert id="saveNews" parameterType="com.hxy.core.news.entity.News">
		insert into news(title,content,createTime,channelName,categoryWeb)
		values(#{title},#{content},now(),#{channelName},#{categoryWeb})
	</insert>
	<update id="updateNews" parameterType="com.hxy.core.news.entity.News">
		update news set title=#{title},content=#{content} where categoryWeb=#{categoryWeb}
	</update>
	<delete id="deleteNews" parameterType="string">
		delete n
		from news n inner join web_news_type t on n.categoryWeb = t.id
		where t.id=#{typeId} and t.type=3
	</delete>
</mapper>