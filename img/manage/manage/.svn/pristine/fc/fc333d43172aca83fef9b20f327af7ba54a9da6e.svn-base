<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hxy.core.userinfo.dao.UserInfoMapper">
	<resultMap type="com.hxy.core.userinfo.entity.UserInfo" id="userInfoResult">
		<id column="USER_ID" property="userId" />
		<result column="USER_NAME" property="userName" />
		<result column="tel_id" property="telId" />
		<result column="pic_url" property="picUrl" />
		<result column="sex" property="sex" />
		<result column="remarks" property="remarks" />
		<result column="aliasname" property="aliasname" />
		<result column="studentnumber" property="studentnumber" />
		<result column="card" property="card" />
		<result column="accountNum" property="accountNum" />
		<result column="nation" property="nation" />
		<result column="political" property="political" />
		<result column="nationality" property="nationality" />
		<result column="birthday" property="birthday" />
		<result column="entranceTime" property="entranceTime" />
		<result column="graduationTime" property="graduationTime" />
		<result column="email" property="email" />
		<result column="qq" property="qq" />
		<result column="weibo" property="weibo" />
		<result column="personalWebsite" property="personalWebsite" />
		<result column="mailingAddress" property="mailingAddress" />
		<result column="residentialArea" property="residentialArea" />
		<result column="workUnit" property="workUnit" />
		<result column="name_pinyin" property="namePinyin" />
		<result column="position" property="position" />
		<result column="industryType" property="industryType" />
		<result column="enterprise" property="enterprise" />
		<result column="workTel" property="workTel" />
		<result column="workAddress" property="workAddress" />
		<result column="resume" property="resume" />
		<result column="create_time" property="createTime" />
		<result column="full_name" property="fullName" />
		<result column="cardType" property="cardType" />
		<result column="status" property="status" />
		<result column="resourceArea" property="resourceArea" />
		<result column="studentType" property="studentType" />
		<result column="use_time" property="useTime" />
		<result column="schoolName" property="schoolName" />
		<result column="departName" property="departName" />
		<result column="departAliasName" property="departAliasName" />
		<result column="gradeName" property="gradeName" />
		<result column="className" property="className" />
		<result column="majorName" property="majorName" />
		<result column="majorId" property="majorId" />
		<result column="majorName" property="majorName" />
		<result column="checkflag" property="checkFlag" />
		<result column="checkIdea" property="checkIdea" />
		<result column="residentialTel" property="residentialTel" />
		<result column="schoolId" property="schoolId" />
		<result column="departId" property="departId" />
		<result column="gradeId" property="gradeId" />
		<result column="classId" property="classId" />
		<result column="mobile_local" property="mobileLocal" />
		<result column="alumniId" property="alumniId" />
		<result column="pic_url" property="picUrl" />
		<result column="hobbies" property="hobbies" />
		<result column="dept_id" property="dept_id"/>
		<result column="dept_name" property="dept_name"/>
	</resultMap>
	<select id="countByDeptId" parameterType="map" resultType="long">
		select count(user_id) from userbase_info
		<where>
			<if test="deptList!=null and deptList.size()>0">
				<foreach collection="deptList" open="(" separator="or"
					close=")" item="dept">
					user_id like concat(#{dept.deptId},'%')
				</foreach>
			</if>
			<if test="telId!=null and telId!=''">
				and tel_id like concat('%',#{telId},'%')
			</if>
			<if test="userName!=null and userName!=''">
				and user_name like concat('%',#{userName},'%')
			</if>
			<if test="deptId1!=null and deptId1!=''">
				and user_id like concat(#{deptId1},'%')
			</if>
			<if test="studentType!=null and studentType!=''">
				and studentType =#{studentType}
			</if>
			<if test="majorId!=null and majorId!=0">
				and majorId =#{majorId}
			</if>
			<if test="studentnumber!=null and studentnumber!=''">
				and studentnumber like concat('%',#{studentnumber},'%')
			</if>
			<if test="residentialArea!=null and residentialArea!=''">
				and case when residentialArea is not null and
				residentialArea!=''
				then residentialArea like
				concat('%',#{residentialArea},'%')
				else
				mobile_local like
				concat('%',#{residentialArea},'%')
				end
			</if>
			<if test="workUnit!=null and workUnit!=''">
				and workUnit like concat('%',#{workUnit},'%')
			</if>
			<if test="mailingAddress!=null and mailingAddress!=''">
				and mailingAddress like concat('%',#{mailingAddress},'%')
			</if>
			<if test="industryType!=null and industryType!=''">
				and industryType like concat('%',#{industryType},'%')
			</if>
			<if test="regflag!=null and regflag!='' and regflag==1">
				and (accountNum is not null and accountNum!='')
			</if>
			<if test="regflag!=null and regflag!='' and regflag==0">
				and (accountNum is null or accountNum='')
			</if>
		</where>
	</select>

	<select id="selectByDeptId" parameterType="map" resultMap="userInfoResult">
		select u.*,
		d.dept_name as className,
		d1.dept_name as gradeName,
		d2.dept_name as departName,
		d3.dept_name as schoolName,
		m.majorName as
		majorName
		from userbase_info u
		left join cy_dept_info d on
		LEFT(u.user_id,16)=d.dept_id
		LEFT JOIN cy_dept_info d1 ON
		d1.DEPT_ID=LEFT(u.user_id,14)
		LEFT JOIN cy_dept_info d2 ON
		d2.DEPT_ID=LEFT(u.user_id,10)
		LEFT JOIN cy_dept_info d3 ON
		d3.DEPT_ID=LEFT(u.user_id,6)
		left join major m on
		m.majorId=u.majorId
		<where>
			<if test="deptList!=null and deptList.size()>0">
				<foreach collection="deptList" open="(" separator="or"
					close=")" item="dept">
					user_id like concat(#{dept.deptId},'%')
				</foreach>
			</if>
			<if test="telId!=null and telId!=''">
				and tel_id like concat('%',#{telId},'%')
			</if>
			<if test="userName!=null and userName!=''">
				and user_name like concat('%',#{userName},'%')
			</if>
			<if test="deptId1!=null and deptId1!=''">
				and user_id like concat(#{deptId1},'%')
			</if>
			<if test="studentType!=null and studentType!=''">
				and studentType =#{studentType}
			</if>
			<if test="majorId!=null and majorId!=0">
				and u.majorId =#{majorId}
			</if>
			<if test="studentnumber!=null and studentnumber!=''">
				and studentnumber like concat('%',#{studentnumber},'%')
			</if>
			<if test="residentialArea!=null and residentialArea!=''">
				and case when residentialArea is not null and
				residentialArea!=''
				then residentialArea like
				concat('%',#{residentialArea},'%')
				else
				mobile_local like
				concat('%',#{residentialArea},'%')
				end
			</if>
			<if test="workUnit!=null and workUnit!=''">
				and workUnit like concat('%',#{workUnit},'%')
			</if>
			<if test="mailingAddress!=null and mailingAddress!=''">
				and mailingAddress like concat('%',#{mailingAddress},'%')
			</if>
			<if test="industryType!=null and industryType!=''">
				and industryType like concat('%',#{industryType},'%')
			</if>
			<if test="regflag!=null and regflag!='' and regflag==1">
				and (accountNum is not null and accountNum!='')
			</if>
			<if test="regflag!=null and regflag!='' and regflag==0">
				and (accountNum is null or accountNum='')
			</if>
		</where>
		order by ${sort} ${order}
		limit #{start},#{rows}
	</select>
	<select id="countByDeptIdForAlumni" parameterType="map"
		resultType="long">
		SELECT COUNT(user_id) from (SELECT user_id FROM userbase_info
		WHERE
		accountNum
		is NOT null and accountNum!=''
		<if test="deptList!=null and deptList.size()>0">
		and
				<foreach collection="deptList" open="(" separator="or"
					close=")" item="dept">
					 user_id like concat(#{dept.deptId},'%')
				</foreach>
			</if>
		<if test="userName!=null and userName!=''">
			and user_name like concat('%',#{userName},'%')
		</if>
		<if test="alumniId!=null and alumniId!=0">
			and alumniId=#{alumniId}
		</if>
		<if test="deptId1!=null and deptId1!=''">
			and user_id like concat(#{deptId1},'%')
		</if>
		<if test="studentType!=null and studentType!=''">
			and studentType =#{studentType}
		</if>
		<if test="majorId!=null and majorId!=0">
			and majorId =#{majorId}
		</if>
		<if test="industryType!=null and industryType!=''">
			and industryType =#{industryType}
		</if>
		<if test="sex!=null and sex!=''">
			and sex =#{sex}
		</if>
		<if test="birthday!=null and birthday!=''">
			and date_format(birthday,'%Y') =#{birthday}
		</if>
		<if test="entranceTime!=null and entranceTime!=''">
			and date_format(entranceTime,'%Y') =#{entranceTime}
		</if>
		GROUP BY accountNum
		UNION ALL
		select user_id
		from
		userbase_info where
		(accountNum is NULL OR accountNum='')
		<if test="deptList!=null and deptList.size()>0">
		and
				<foreach collection="deptList" open="(" separator="or"
					close=")" item="dept">
					 user_id like concat(#{dept.deptId},'%')
				</foreach>
			</if>
		<if test="userName!=null and userName!=''">
			and user_name like concat('%',#{userName},'%')
		</if>
		<if test="alumniId!=null and alumniId!=0">
			and alumniId=#{alumniId}
		</if>
		<if test="deptId1!=null and deptId1!=''">
			and user_id like concat(#{deptId1},'%')
		</if>
		<if test="studentType!=null and studentType!=''">
			and studentType =#{studentType}
		</if>
		<if test="majorId!=null and majorId!=0">
			and majorId =#{majorId}
		</if>
		<if test="industryType!=null and industryType!=''">
			and industryType =#{industryType}
		</if>
		<if test="sex!=null and sex!=''">
			and sex =#{sex}
		</if>
		<if test="birthday!=null and birthday!=''">
			and date_format(birthday,'%Y') =#{birthday}
		</if>
		<if test="entranceTime!=null and entranceTime!=''">
			and date_format(entranceTime,'%Y') =#{entranceTime}
		</if>
		) uu
	</select>

	<select id="selectByDeptIdForAlumni" parameterType="map"
		resultMap="userInfoResult">
		select
		accountNum,GROUP_CONCAT(user_id) as
		user_id,user_name,sex,tel_id,email,workUnit,position,residentialArea,GROUP_CONCAT(REPLACE(full_name,',','
		'))
		as full_name from userbase_info u LEFT JOIN cy_dept_info d ON
		LEFT(user_id,16)=d.dept_id WHERE
		accountNum is NOT null and
		accountNum!=''
		<if test="deptList!=null and deptList.size()>0">
		and
				<foreach collection="deptList" open="(" separator="or"
					close=")" item="dept">
					 user_id like concat(#{dept.deptId},'%')
				</foreach>
			</if>
		<if test="userName!=null and userName!=''">
			and user_name like concat('%',#{userName},'%')
		</if>
		<if test="alumniId!=null and alumniId!=0">
			and alumniId=#{alumniId}
		</if>
		<if test="deptId1!=null and deptId1!=''">
			and user_id like concat(#{deptId1},'%')
		</if>
		<if test="studentType!=null and studentType!=''">
			and studentType =#{studentType}
		</if>
		<if test="majorId!=null and majorId!=0">
			and majorId =#{majorId}
		</if>
		<if test="industryType!=null and industryType!=''">
			and industryType =#{industryType}
		</if>
		<if test="sex!=null and sex!=''">
			and sex =#{sex}
		</if>
		<if test="birthday!=null and birthday!=''">
			and date_format(birthday,'%Y') =#{birthday}
		</if>
		<if test="entranceTime!=null and entranceTime!=''">
			and date_format(entranceTime,'%Y') =#{entranceTime}
		</if>
		GROUP BY accountNum
		UNION ALL
		select
		accountNum,user_id,user_name,sex,tel_id,email,workUnit,position,residentialArea,REPLACE(full_name,',','
		')
		as full_name from
		userbase_info u LEFT JOIN cy_dept_info d ON
		LEFT(user_id,16)=d.dept_id where (accountNum is NULL OR accountNum='')
		<if test="deptList!=null and deptList.size()>0">
			and
				<foreach collection="deptList" open="(" separator="or"
					close=")" item="dept">
					 user_id like concat(#{dept.deptId},'%')
				</foreach>
		</if>
		<if test="userName!=null and userName!=''">
			and user_name like concat('%',#{userName},'%')
		</if>
		<if test="alumniId!=null and alumniId!=0">
			and alumniId=#{alumniId}
		</if>
		<if test="deptId1!=null and deptId1!=''">
			and user_id like concat(#{deptId1},'%')
		</if>
		<if test="studentType!=null and studentType!=''">
			and studentType =#{studentType}
		</if>
		<if test="majorId!=null and majorId!=0">
			and majorId =#{majorId}
		</if>
		<if test="industryType!=null and industryType!=''">
			and industryType =#{industryType}
		</if>
		<if test="sex!=null and sex!=''">
			and sex =#{sex}
		</if>
		<if test="birthday!=null and birthday!=''">
			and date_format(birthday,'%Y') =#{birthday}
		</if>
		<if test="entranceTime!=null and entranceTime!=''">
			and date_format(entranceTime,'%Y') =#{entranceTime}
		</if>
		limit #{start},#{rows}
	</select>
	
	<select id="selectUserInfoByName" parameterType="string" resultMap="userInfoResult">
		select
		appuser_id as accountNum,GROUP_CONCAT(user_id) as
		user_id,user_name,sex,tel_id,email,workUnit,fullName as full_name from userbase_info LEFT JOIN class_info ON
		userbase_info.class_id=class_info.class_id WHERE
		appuser_id is NOT null and
		appuser_id!=''
		and user_name=#{userName}
		GROUP BY appuser_id
		UNION ALL
		select
		appuser_id as accountNum,user_id,user_name,sex,tel_id,email,workUnit,fullName as full_name from
		userbase_info LEFT JOIN class_info ON
		userbase_info.class_id=class_info.class_id where (appuser_id is NULL OR appuser_id='')
		and user_name=#{userName}
	</select>

	<select id="selectAllByDeptId" parameterType="string" resultMap="userInfoResult">
		select * from userbase_info where user_id like concat(#{deptId},'%')
	</select>
	<delete id="delete" parameterType="list">
		delete from userbase_info where user_id in
		<foreach collection="list" open="(" close=")" item="ids"
			separator=",">
			#{ids}
		</foreach>
	</delete>
	<select id="selectByIds" parameterType="list" resultMap="userInfoResult">
		select * from userbase_info where user_id in
		<foreach collection="list" open="(" close=")" item="ids"
			separator=",">
			#{ids}
		</foreach>
	</select>
	<insert id="save" parameterType="com.hxy.core.userinfo.entity.UserInfo">
		insert into
		userbase_info(USER_ID,USER_NAME,TEL_ID,SEX,remarks,aliasname,studentnumber,card,accountNum,nation,political,nationality,birthday,entranceTime,graduationTime,email,qq,weibo,personalWebsite,mailingAddress,residentialArea,workUnit,name_pinyin,position,industryType,enterprise,workTel,workAddress,resume,create_time,cardType,status,resourceArea,studentType,programLength,majorId,checkflag,residentialTel)
		values(#{userId},#{userName},#{telId},#{sex},#{remarks},#{aliasname},#{studentnumber},#{card},#{accountNum},#{nation},#{political},#{nationality},#{birthday},#{entranceTime},#{graduationTime},#{email},#{qq},#{weibo},#{personalWebsite},#{mailingAddress},#{residentialArea},#{workUnit},#{namePinyin},#{position},#{industryType},#{enterprise},#{workTel},#{workAddress},#{resume},#{createTime},#{cardType},#{status},#{resourceArea},#{studentType},#{programLength},#{majorId},#{checkFlag},#{residentialTel})
	</insert>
	<update id="update" parameterType="com.hxy.core.userinfo.entity.UserInfo">
		update userbase_info set
		aliasname=#{aliasname},birthday=#{birthday},tel_id=#{telId},email=#{email},qq=#{qq},
		remarks=#{remarks},nation=#{nation},political=#{political},nationality=#{nationality},
		sex=#{sex},
		birthday=#{birthday},weibo=#{weibo},personalWebsite=#{personalWebsite},
		mailingAddress=#{mailingAddress},residentialArea=#{residentialArea},workUnit=#{workUnit},position=#{position},
		industryType=#{industryType},enterprise=#{enterprise},workTel=#{workTel},workAddress=#{workAddress},status=#{status},residentialTel=#{residentialTel},alumniId=#{alumniId}
		<if test="majorId!=0">
			,majorId=#{majorId}
		</if>
		<if test="newUserId!=null and newUserId!=''">
			,user_id=#{newUserId}
		</if>
		where user_id=#{userId}
	</update>

	<update id="updateFromUserProfile" parameterType="com.hxy.core.userinfo.entity.UserInfo">
		update
		userbase_info set
		email=#{email},
		<if test="sex!=null and sex!=''">
			sex=#{sex},
		</if>
		residentialArea=#{residentialArea},workUnit=#{workUnit},position=#{position},hobbies=#{hobbies},
		industryType=#{industryType},alumniId=#{alumniId},tel_id=#{telId} where
		accountNum=#{accountNum}
	</update>

	<update id="updateAuthen2User" parameterType="com.hxy.core.userinfo.entity.UserInfo">
		update userbase_info
		set
		tel_id=#{telId},alumniId=#{alumniId},accountNum=#{accountNum},pic_url=#{picUrl}
		where user_id=#{userId}
	</update>

	<update id="updateAccountNum" parameterType="com.hxy.core.userinfo.entity.UserInfo">
		update userbase_info
		set accountNum=#{accountNum} where user_id=#{userId}
	</update>

	<!-- 根据accountNum更新userInfo -->
	<update id="updateByAccountNum" parameterType="com.hxy.core.userinfo.entity.UserInfo">
		update userbase_info
		<set>
			<if test="'1'=='1'">
				accountNum=#{accountNum},
			</if>
			<if test="userName!=null and userName!= '' ">
				user_name=#{userName},
			</if>
			<if test="telId !=null and telId!=''">
				tel_id=#{telId},
			</if>
			<if test="sex !=null and sex=!''">
				sex=#{sex},
			</if>
			<if test="email !=null and email!=''">
				email=#{email},
			</if>
			<if test="residentialArea !=null and residentialArea!=''">
				residentialArea=#{residentialArea},
			</if>
			<if test="workUnit !=null and workUnit!=''">
				workUnit=#{workUnit},
			</if>
			<if test="industryType !=null and industryType!=''">
				industryType=#{industryType},
			</if>
			<if test="position !=null and position!=''">
				position=#{position},
			</if>
			<if test="alumniId !=null and alumniId!=''">
				alumniId=#{alumniId},
			</if>
		</set>
		where accountNum=#{accountNum}
	</update>



	<update id="updateOthers" parameterType="com.hxy.core.userinfo.entity.UserInfo">
		update userbase_info set
		aliasname=#{aliasname},tel_id=#{telId},email=#{email},qq=#{qq},
		remarks=#{remarks},nation=#{nation},political=#{political},nationality=#{nationality},
		birthday=#{birthday},weibo=#{weibo},personalWebsite=#{personalWebsite},
		mailingAddress=#{mailingAddress},residentialArea=#{residentialArea},workUnit=#{workUnit},position=#{position},
		industryType=#{industryType},enterprise=#{enterprise},workTel=#{workTel},workAddress=#{workAddress},status=#{status},residentialTel=#{residentialTel}
		where user_id=#{userId}
	</update>
	<select id="selectByUserId" parameterType="string" resultMap="userInfoResult">
		select u.*,
		d.full_name,
		d.dept_name as className,
		d.dept_id as classId,
		d1.dept_name as gradeName,
		d1.dept_id as gradeId,
		d2.dept_name
		as
		departName,
		d2.dept_id as departId,
		d3.dept_name as schoolName,
		d3.dept_id as schoolId,
		m.majorName as majorName
		from userbase_info u
		left join cy_dept_info d on LEFT(u.user_id,16)=d.dept_id
		LEFT JOIN
		cy_dept_info d1 ON d1.DEPT_ID=LEFT(u.user_id,14)
		LEFT JOIN cy_dept_info
		d2 ON d2.DEPT_ID=LEFT(u.user_id,10)
		LEFT JOIN cy_dept_info d3 ON
		d3.DEPT_ID=LEFT(u.user_id,6)
		left join major m on
		m.majorId=u.majorId
		where user_id=#{userId}
	</select>
	<select id="selectByUserIdLess" parameterType="string"
		resultMap="userInfoResult">
		select u.*,d.dept_name as className,
		d.full_name
		from
		userbase_info u
		left join cy_dept_info d on LEFT(u.user_id,16)=d.dept_id
		where
		user_id=#{userId}
	</select>
	<select id="selectUserByClassIdLess" parameterType="string"
		resultMap="userInfoResult">
		select u.*,d.dept_name as className,
		d.full_name
		from
		userbase_info u
		left join cy_dept_info d on LEFT(u.user_id,16)=d.dept_id
		where user_id
		like
		concat(#{classId},'%')
	</select>
	<select id="getUserInfoByUserIdForAlumni" parameterType="list"
		resultMap="userInfoResult">
		select u.*,
		d.full_name,
		d.dept_name as className,
		d.dept_id as classId,
		d1.dept_name as gradeName,
		d1.dept_id as gradeId,
		d2.dept_name
		as
		departName,
		d2.dept_id as departId,
		d3.dept_name as schoolName,
		d3.dept_id as schoolId,
		m.majorName as majorName
		from userbase_info u
		left join cy_dept_info d on LEFT(u.user_id,16)=d.dept_id
		LEFT JOIN
		cy_dept_info d1 ON d1.DEPT_ID=LEFT(u.user_id,14)
		LEFT JOIN cy_dept_info
		d2 ON d2.DEPT_ID=LEFT(u.user_id,10)
		LEFT JOIN cy_dept_info d3 ON
		d3.DEPT_ID=LEFT(u.user_id,6)
		left join major m on
		m.majorId=u.majorId
		where user_id in
		<foreach collection="list" open="(" separator="," close=")"
			item="ids">
			#{ids}
		</foreach>
	</select>
	<select id="selectUserToGetTel" resultMap="userInfoResult">
		select u.*,d.full_name
		from userbase_info u left join cy_dept_info d on
		LEFT(u.user_id,16)=d.dept_id where tel_id is not null and tel_id!=''
	</select>

	<!-- 新增查询所有手机号字段不为空或者邮箱不为空的用户，并且分页## -->
	<select id="selectUserToGetTelPage" resultMap="userInfoResult">
		select * from userbase_info
		<where>
			<if test="deptList!=null and deptList.size()>0">
				<foreach collection="deptList" open="(" separator="or"
					close=")" item="dept">
					user_id like concat(#{dept.deptId},'%')
				</foreach>
			</if>
			<if test="telId!=null and telId!=''">
				and tel_id like concat('%',#{telId},'%')
			</if>
			<if test="userName!=null and userName!=''">
				and user_name like concat('%',#{userName},'%')
			</if>
			<if test="deptId1!=null and deptId1!=''">
				and user_id like concat(#{deptId1},'%')
			</if>
			<if test="studentType!=null and studentType!=''">
				and studentType =#{studentType}
			</if>
			<if test="majorId!=null and majorId!=0">
				and majorId =#{majorId}
			</if>
			<if test="studentnumber!=null and studentnumber!=''">
				and studentnumber like concat('%',#{studentnumber},'%')
			</if>
			<if test="residentialArea!=null and residentialArea!=''">
				and case when residentialArea is not null and
				residentialArea!=''
				then residentialArea like
				concat('%',#{residentialArea},'%')
				else
				mobile_local like
				concat('%',#{residentialArea},'%')
				end
			</if>
			<if test="workUnit!=null and workUnit!=''">
				and workUnit like concat('%',#{workUnit},'%')
			</if>
			<if test="mailingAddress!=null and mailingAddress!=''">
				and mailingAddress like concat('%',#{mailingAddress},'%')
			</if>
			<if test="industryType!=null and industryType!=''">
				and industryType like concat('%',#{industryType},'%')
			</if>
			<if test="regflag!=null and regflag!='' and regflag==1">
				and (accountNum is not null and accountNum!='')
			</if>
			<if test="regflag!=null and regflag!='' and regflag==0">
				and (accountNum is null or accountNum='')
			</if>
			<if test="alumniId!=null and alumniId!=0">
				and alumniId=#{alumniId}
			</if>
			<if test="phoneNotNull==true">
				and tel_id is not null and tel_id!=''
				group by tel_id
			</if>
			<if test="emailNotNull==true">
				and email is not null and email!=''
				group by email
			</if>
		</where>
	</select>

	<select id="selectUserToGetTelCount" parameterType="map"
		resultType="long">
		select count(user_id) from userbase_info where 1 = 1
		<if test="deptList!=null and deptList.size()>0">
			<foreach collection="deptList" open="(" separator="or" close=")"
				item="dept">
				user_id like concat(#{dept.deptId},'%')
			</foreach>
		</if>
		<if test="telId!=null and telId!=''">
			and tel_id like concat('%',#{telId},'%')
		</if>
		<if test="userName!=null and userName!=''">
			and user_name like concat('%',#{userName},'%')
		</if>
		<if test="deptId1!=null and deptId1!=''">
			and user_id like concat(#{deptId1},'%')
		</if>
		<if test="studentType!=null and studentType!=''">
			and studentType =#{studentType}
		</if>
		<if test="majorId!=null and majorId!=0">
			and majorId =#{majorId}
		</if>
		<if test="studentnumber!=null and studentnumber!=''">
			and studentnumber like concat('%',#{studentnumber},'%')
		</if>
		<if test="residentialArea!=null and residentialArea!=''">
			and residentialArea like
			concat('%',#{residentialArea},'%')
		</if>
		<if test="workUnit!=null and workUnit!=''">
			and workUnit like concat('%',#{workUnit},'%')
		</if>
		<if test="mailingAddress!=null and mailingAddress!=''">
			and mailingAddress like concat('%',#{mailingAddress},'%')
		</if>
		<if test="phoneNotNull==true">
			and tel_id is not null and tel_id!=''
		</if>
		<if test="emailNotNull==true">
			and email is not null and email!=''
		</if>
	</select>



	<select id="selectUserByClassIdAndName" parameterType="map"
		resultMap="userInfoResult">
		select user_id,card,accountNum,sex from userbase_info where
		user_id like concat(#{classId},'%') and user_name=#{userName}
	</select>
	<update id="updateUserAccountNum" parameterType="map">
		update
		userbase_info set accountNum=#{accountNum} where user_id=#{userId}
	</update>
	<select id="selectAllProByUserId" parameterType="map" resultMap="userInfoResult">
		select * from userbase_info where user_id=#{userId}
	</select>
	<select id="selectAllUserByClassId" parameterType="map"
		resultMap="userInfoResult">
		select * from userbase_info where user_id like
		concat(#{classId},'%')
	</select>
	<select id="selectUserByClassId" parameterType="string"
		resultMap="userInfoResult">
		select * from userbase_info where user_id like
		concat(#{classId},'%')
	</select>
	<select id="selectCard" parameterType="map" resultMap="userInfoResult">
		select user_id,user_name,tel_id,telpic_url,studentnumber,sex,card from
		userbase_info where user_id in
		<foreach collection="list" item="id" open="(" separator=","
			close=")">
			#{id}
		</foreach>
	</select>
	<select id="selectByUserName" parameterType="map" resultMap="userInfoResult">
		select
		user_id,user_name,tel_id,telpic_url,studentnumber,sex,card,accountNum
		from userbase_info where user_name=#{userName}
	</select>
	<select id="selectByName" parameterType="string" resultMap="userInfoResult">
		select
		user_id,user_name,
		full_name
		from userbase_info
		left join
		cy_dept_info
		on dept_id=LEFT(user_id,16)
		where user_name=#{name}
	</select>
	<select id="selectAlumni" parameterType="map" resultMap="userInfoResult">
		select
		*
		from userbase_info
		where accountNum is not null and
		accountNum!='' and user_name=#{name}
		<if test="sex!=null and sex!=''">
			and sex=#{sex}
		</if>
		<if test="profession!=null and profession!=''">
			and industryType like concat('%',#{profession},'%')
		</if>
		<if test="address!=null and address!=''">
			and residentialArea like concat('%',#{address},'%')
		</if>
	</select>
	<select id="selectUserInClass" parameterType="map" resultType="long">
		select count(user_id) from userbase_info where user_id like
		concat(#{classId},'%') and user_name in
		<foreach collection="list" item="userName" open="(" separator=","
			close=")">
			#{userName}
		</foreach>
	</select>
	<select id="selectUserInfo" parameterType="map" resultMap="userInfoResult">
		select * from userbase_info where user_id like concat(#{gmid},'%') and
		user_name=#{name}
	</select>
	<update id="updateTelId" parameterType="map" flushCache="true">
		update
		userbase_info set tel_id=#{telId},use_time=#{useTime} where
		user_id=#{userId}
	</update>
	<select id="selectAll" resultMap="userInfoResult">
		select u.*,
		d.dept_name as
		className,
		d1.dept_name as gradeName,
		d2.dept_name as departName,
		d3.dept_name as schoolName,
		m.majorName as majorName
		from userbase_info u
		left join cy_dept_info d on LEFT(u.user_id,16)=d.dept_id
		LEFT JOIN
		cy_dept_info d1 ON d1.DEPT_ID=LEFT(u.user_id,14)
		LEFT JOIN cy_dept_info
		d2 ON d2.DEPT_ID=LEFT(u.user_id,10)
		LEFT JOIN cy_dept_info d3
		ON
		d3.DEPT_ID=LEFT(u.user_id,6)
		left join major m on
		m.majorId=u.majorId
	</select>
	<select id="countFor" parameterType="map" resultType="long">
		select
		count(user_id) from userbase_info
		<where>
			<choose>
				<when
					test="userName!=null and userName!='' and (telId==null or telId=='')">
					user_name = #{userName}
				</when>
				<when
					test="telId!=null and telId!='' and (userName==null or userName=='')">
					and tel_id = #{telId}
				</when>
				<otherwise>
					user_name = #{userName}
					and tel_id = #{telId}
				</otherwise>
			</choose>
		</where>
	</select>
	<select id="selectListFor" parameterType="map" resultMap="userInfoResult">
		select
		u.*,d.full_name,d1.dept_name as className,d2.dept_name as
		gradeName,d3.dept_name as departName, d4.dept_name as
		schoolName,m.majorName as majorName from userbase_info u left join
		cy_dept_info d on LEFT(u.user_id,16)=d.dept_id
		LEFT JOIN cy_dept_info
		d1 ON d1.DEPT_ID = LEFT(u.user_id,16)
		LEFT JOIN cy_dept_info d2 ON
		d2.DEPT_ID=LEFT(u.user_id,14)
		LEFT JOIN cy_dept_info d3 ON
		d3.DEPT_ID=LEFT(u.user_id,10)
		LEFT JOIN cy_dept_info d4 ON
		d4.DEPT_ID=LEFT(u.user_id,6)
		LEFT JOIN major m on
		m.majorId=u.majorId
		<where>
			<choose>
				<when
					test="userName!=null and userName!='' and (telId==null or telId=='')">
					user_name = #{userName}
				</when>
				<when
					test="telId!=null and telId!='' and (userName==null or userName=='')">
					and tel_id = #{telId}
				</when>
				<otherwise>
					user_name = #{userName}
					and tel_id = #{telId}
				</otherwise>
			</choose>
		</where>
		limit #{start},#{rows}
	</select>



	<update id="updateIdea" parameterType="com.hxy.core.userinfo.entity.UserInfo">
		update userbase_info set
		checkIdea=#{checkIdea},checkFlag=#{checkFlag} where user_id=#{userId}
	</update>
	<delete id="deleteByDeptIdAll" parameterType="string">
		delete from userbase_info
		<where>
			<if test="deptList!=null and deptList.size()>0">
				<foreach collection="deptList" open="(" separator="or"
					close=")" item="dept">
					user_id like concat(#{dept.deptId},'%')
				</foreach>
			</if>
			<if test="telId!=null and telId!=''">
				and tel_id like concat('%',#{telId},'%')
			</if>
			<if test="userName!=null and userName!=''">
				and user_name like concat('%',#{userName},'%')
			</if>
			<if test="deptId1!=null and deptId1!=''">
				and user_id like concat(#{deptId1},'%')
			</if>
			<if test="studentType!=null and studentType!=''">
				and studentType =#{studentType}
			</if>
			<if test="majorId!=null and majorId!=0">
				and majorId =#{majorId}
			</if>
			<if test="studentnumber!=null and studentnumber!=''">
				and studentnumber like concat('%',#{studentnumber},'%')
			</if>
			<if test="residentialArea!=null and residentialArea!=''">
				and residentialArea like
				concat('%',#{residentialArea},'%')
			</if>
			<if test="workUnit!=null and workUnit!=''">
				and workUnit like concat('%',#{workUnit},'%')
			</if>
			<if test="mailingAddress!=null and mailingAddress!=''">
				and mailingAddress like concat('%',#{mailingAddress},'%')
			</if>
			<if test="isimport!=null">
				and isimport=#{isimport}
			</if>
		</where>
	</delete>
	<select id="selectByDeptIdForExport" parameterType="map"
		resultMap="userInfoResult">
		select u.*,
		d.dept_name as className,
		d1.dept_name as gradeName,
		d2.dept_name as departName,
		d3.dept_name as schoolName,
		m.majorName as
		majorName
		from userbase_info u
		left join cy_dept_info d on
		LEFT(u.user_id,16)=d.dept_id
		LEFT JOIN cy_dept_info d1 ON
		d1.DEPT_ID=LEFT(u.user_id,14)
		LEFT JOIN cy_dept_info d2 ON
		d2.DEPT_ID=LEFT(u.user_id,10)
		LEFT JOIN cy_dept_info d3 ON
		d3.DEPT_ID=LEFT(u.user_id,6)
		left join major m on
		m.majorId=u.majorId
		<where>
			<if test="deptList!=null and deptList.size()>0">
				<foreach collection="deptList" open="(" separator="or"
					close=")" item="dept">
					user_id like concat(#{dept.deptId},'%')
				</foreach>
			</if>
			<if test="telId!=null and telId!=''">
				and tel_id like concat('%',#{telId},'%')
			</if>
			<if test="userName!=null and userName!=''">
				and user_name like concat('%',#{userName},'%')
			</if>
			<if test="deptId1!=null and deptId1!=''">
				and user_id like concat(#{deptId1},'%')
			</if>
			<if test="studentType!=null and studentType!=''">
				and studentType =#{studentType}
			</if>
			<if test="majorId!=null and majorId!=0">
				and u.majorId =#{majorId}
			</if>
			<if test="studentnumber!=null and studentnumber!=''">
				and studentnumber like concat('%',#{studentnumber},'%')
			</if>
			<if test="residentialArea!=null and residentialArea!=''">
				and case when residentialArea is not null and
				residentialArea!=''
				then residentialArea like
				concat('%',#{residentialArea},'%')
				else
				mobile_local like
				concat('%',#{residentialArea},'%')
				end
			</if>
			<if test="workUnit!=null and workUnit!=''">
				and workUnit like concat('%',#{workUnit},'%')
			</if>
			<if test="mailingAddress!=null and mailingAddress!=''">
				and mailingAddress like concat('%',#{mailingAddress},'%')
			</if>
			<if test="industryType!=null and industryType!=''">
				and industryType like concat('%',#{industryType},'%')
			</if>
		</where>
	</select>

	<!-- 根据accountNum查询 -->
	<select id="selectByAccountNum" parameterType="map" resultMap="userInfoResult">
		select u.*,
		d.dept_name as className,
		d1.dept_name as gradeName,
		d2.dept_name as departName,
		d3.dept_name as schoolName,
		m.majorName as
		majorName
		from userbase_info u
		left join cy_dept_info d on
		LEFT(u.user_id,16)=d.dept_id
		LEFT JOIN cy_dept_info d1 ON
		d1.DEPT_ID=LEFT(u.user_id,14)
		LEFT JOIN cy_dept_info d2 ON
		d2.DEPT_ID=LEFT(u.user_id,10)
		LEFT JOIN cy_dept_info d3 ON
		d3.DEPT_ID=LEFT(u.user_id,6)
		left join major m on
		m.majorId=u.majorId
		where accountNum = #{accountNum}
	</select>

	<!-- 根据多个accountNum查询 -->
	<select id="selectByAccountNums" parameterType="list"
		resultType="com.hxy.core.userinfo.entity.UserInfo">
		select u.*,
		d.dept_name as className,
		d.full_name as fullName,
		m.majorName as
		majorName
		from userbase_info u
		left join cy_dept_info d on
		LEFT(u.user_id,16)=d.dept_id
		left join major m on
		m.majorId=u.majorId
		where accountNum in
		<foreach collection="list" open="(" close=")" item="ids"
			separator=",">
			#{ids}
		</foreach>
	</select>

	<select id="selectByAccountNum2FullName" parameterType="map"
		resultMap="userInfoResult">
		select
		u.user_id,u.user_name,u.sex,u.pic_url,u.residentialArea,
		d.full_name
		from userbase_info u
		left join cy_dept_info d on
		LEFT(u.user_id,16)=d.dept_id
		where accountNum = #{accountNum}
	</select>

	<select id="selectMobileLocalIsNull" resultMap="userInfoResult">
		select * from
		userbase_info where tel_id is not null and tel_id!='' and (mobile_local
		is null or mobile_local='')
	</select>

	<update id="updateMobileLocal" parameterType="com.hxy.core.userinfo.entity.UserInfo">
		update userbase_info
		set mobile_local=#{mobileLocal} where user_id=#{userId}
	</update>
	<update id="updateBase" parameterType="com.hxy.core.userinfo.entity.UserInfo">
		update userbase_info set
		user_name=#{userName},sex=#{sex},studentType=#{studentType},
		programLength=#{programLength},studentnumber=#{studentnumber},resourceArea=#{resourceArea},
		entranceTime=#{entranceTime},graduationTime=#{graduationTime}
		<if test="majorId!=0">
			,majorId=#{majorId}
		</if>
		<if test="newUserId!=null and newUserId!=''">
			,user_id=#{newUserId}
		</if>
		where user_id=#{userId}
	</update>
	<select id="selectByMobile" resultMap="userInfoResult">
		select * from userbase_info where tel_id is not null and tel_id!=''
	</select>
	<select id="selectByDeptIdAll" parameterType="map" resultMap="userInfoResult">
		select u.*,d.full_name from userbase_info u left join cy_dept_info d on
		LEFT(u.user_id,16)=d.dept_id
		<where>
			<if test="deptList!=null and deptList.size()>0">
				<foreach collection="deptList" open="(" separator="or"
					close=")" item="dept">
					user_id like concat(#{dept.deptId},'%')
				</foreach>
			</if>
			<if test="telId!=null and telId!=''">
				and tel_id like concat('%',#{telId},'%')
			</if>
			<if test="userName!=null and userName!=''">
				and user_name like concat('%',#{userName},'%')
			</if>
			<if test="deptId1!=null and deptId1!=''">
				and user_id like concat(#{deptId1},'%')
			</if>
			<if test="studentType!=null and studentType!=''">
				and studentType =#{studentType}
			</if>
			<if test="majorId!=null and majorId!=0">
				and majorId =#{majorId}
			</if>
			<if test="studentnumber!=null and studentnumber!=''">
				and studentnumber like concat('%',#{studentnumber},'%')
			</if>
			<if test="residentialArea!=null and residentialArea!=''">
				and case when residentialArea is not null and
				residentialArea!=''
				then residentialArea like
				concat('%',#{residentialArea},'%')
				else
				mobile_local like
				concat('%',#{residentialArea},'%')
				end
			</if>
			<if test="workUnit!=null and workUnit!=''">
				and workUnit like concat('%',#{workUnit},'%')
			</if>
			<if test="mailingAddress!=null and mailingAddress!=''">
				and mailingAddress like concat('%',#{mailingAddress},'%')
			</if>
			<if test="industryType!=null and industryType!=''">
				and industryType like concat('%',#{industryType},'%')
			</if>
		</where>
	</select>
	<select id="selectBirthday" resultMap="userInfoResult">
		select * from userbase_info
		where birthday=DATE_FORMAT(now(),'%Y-%m-%d') and tel_id!='' and tel_id
		is not null
	</select>
	<update id="updatePhoto" parameterType="map">
		update userbase_info set
		pic_url=#{picUrl} where accountNum = #{accountNum}
	</update>
	<update id="updateMobile" parameterType="com.hxy.core.userinfo.entity.UserInfo">
		update userbase_info set tel_id=#{telId} where user_id=#{userId} and (tel_id is null or tel_id='')
	</update>
</mapper>