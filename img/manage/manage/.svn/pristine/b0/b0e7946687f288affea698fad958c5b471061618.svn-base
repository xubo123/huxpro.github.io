<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hxy.core.department.dao.DepartmentMapper">
	
	<select id="getCurrentSchool" parameterType="string" resultType="com.hxy.core.department.entity.School">
		select * from school_config where school_id = #{school_id}
	</select>
	<select id="getCollegeDepartment" resultType="com.hxy.core.department.entity.Department">
		select * from
		department where type = 1
	</select>
	<select id="getAlumniDepartment" resultType="com.hxy.core.department.entity.Department">
		select * from
		department where type != 1
	</select>
    
    <select id="query" parameterType="map" resultType="com.hxy.core.department.entity.Department">
		select * from department
		<where>
            <if test="name!=null and name!=''">
                and departmentName like concat('%',#{name},'%')
            </if>
            <if test="type!=null and type!=''">
                and type=#{type}
            </if>
            <if test="college!=null and college==0">
                and type!=1
            </if>
            <if test="college!=null and college==1">
                and type=1
            </if>
        </where>
		order by type
		limit #{start},#{rows}
    </select>

    <select id="count" parameterType="map" resultType="long">
        select count(department_id) from department
		<where>
            <if test="name!=null and name!=''">
                and departmentName like concat('%',#{name},'%')
            </if>
            <if test="type!=null and type!=''">
                and type=#{type}
            </if>
            <if test="college!=null and college==0">
                and type!=1
            </if>
            <if test="college!=null and college==1">
                and type=1
            </if>
        </where>
    </select>
	
		
	<select id="getById" parameterType="long" resultType="com.hxy.core.department.entity.Department">
		select * from department
		where department_id = #{department_id}
	</select>
	<select id="getByName" parameterType="string" resultType="com.hxy.core.department.entity.Department">
		select * from department
		where departmentName = #{name}
	</select>
	
	<select id="countClass" parameterType="long" resultType="long">
        select count(class_id) from class_info
		where affiliation = #{department_id}
    </select>
    
	<insert id="insert" useGeneratedKeys="true" keyProperty="department_id" parameterType="com.hxy.core.department.entity.Department" >
		insert into department(schoolName, departmentName, type, modifyTime,createAccount) 
		value(#{schoolName}, #{departmentName}, #{type}, Now(), #{createAccount});
	</insert>
	
	<update id="update" parameterType="com.hxy.core.department.entity.Department">
		UPDATE department
		<set>
	        <if test="schoolName !=null and schoolName !='' ">
	            schoolName = #{schoolName},
	        </if>
	        <if test="departmentName !=null and departmentName !='' ">
	            departmentName = #{departmentName},
	        </if>
	        <if test="type !=null and type !='' ">
	            type = #{type},
	        </if>
	        modifyTime = Now()
    	</set>
		where department_id = #{department_id}
	</update>

	
	<delete id="delete" parameterType="long">
		delete from department
		where department_id = #{department_id}
	</delete>
	
	
	
</mapper>